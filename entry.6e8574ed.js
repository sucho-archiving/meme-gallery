class m{constructor(e,i=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=i,this.init()}static calcRowWidth(e){return e.reduce((i,n)=>i+parseInt(window.getComputedStyle(n).width,10),0)}static resizeRow(e,i){!e||(e.length>1?e.forEach(n=>{n.style.width=`${parseInt(window.getComputedStyle(n).width,10)/i*100}%`,n.style.height="auto"}):(e[0].style.width="100%",e[0].style.height="auto"))}init(){this.items=[...this.container.querySelectorAll("img")],this.resize(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.resize()}resize(){this.items.reduce(function(e,i){var n;const d=i.offsetTop;return e.has(d)||e.set(d,[]),(n=e.get(d))===null||n===void 0||n.push(i),e},new Map).forEach(e=>m.resizeRow(e,m.calcRowWidth(e)))}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}toggleItem(e){const i=e.target;i.classList.contains("active")?this.shrink(!1):([...this.container.getElementsByClassName("active")].forEach(n=>n.classList.remove("active")),this.expand(i)),this.onItemToggleCb(i),e.stopPropagation()}expand(e){e.classList.add("active"),this.container.classList.add("zoomed");const i=window.getComputedStyle(this.container),n=parseInt(i.width,10),d=parseInt(i.height,10),a=this.container.getBoundingClientRect().top,h=window.getComputedStyle(e),L=parseInt(h.width,10),S=parseInt(h.height,10);let p=window.innerHeight;d<window.innerHeight?p=d:a>0&&(p-=a);const T=this.items.filter(o=>o.offsetTop==e.offsetTop);let r=p/S;L*r>n&&(r=n/L);let v=a-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const H=e.nextElementSibling.getBoundingClientRect().height,x=p-H;v>0&&(S*r<x&&(v-=x/2-S*r/2),a>0&&(v-=a));const B=T.slice(0,T.indexOf(e)).reduce((o,g)=>o+parseInt(window.getComputedStyle(g).width,10)*r,0),R=n/2-L*r/2-B,E=this.items.reduce(function(o,g){var u;const l=g.offsetTop;return o.has(l)||o.set(l,[]),(u=o.get(l))===null||u===void 0||u.push(g),o},new Map),y=[...E.keys()].indexOf(e.offsetTop),M=[...E.values()].map(o=>parseInt(window.getComputedStyle(o[0]).height,10));E.forEach((o,g,u)=>{const l=[...u.keys()].indexOf(g),W=Math.sign(l-y)*(r-1)*M.slice(...l>=y?[y,l]:[l,y]).reduce((c,I)=>c+I,0)-v;o.map(c=>({item:c,width:parseInt(window.getComputedStyle(c).width,10)})).forEach((c,I,P)=>{const X=(P.slice(0,I).reduce((Y,N)=>Y+N.width,0)*(r-1)+R)/c.width*100,F=W/parseInt(window.getComputedStyle(c.item).height,10)*100;c.item.style.transformOrigin="0% 0%",c.item.style.transform="translate("+X.toFixed(8)+"%, "+F.toFixed(8)+"%) scale("+r.toFixed(8)+")"})})}}let f;const s=document.getElementById("meme-wall"),b=s.querySelectorAll("[data-types]"),z=document.querySelector("select"),U=document.querySelector("button.shuffle"),$=document.querySelector("button.search"),w=document.querySelector("div.search input"),j=(t,e)=>{const i=new IntersectionObserver((n,d)=>{n.forEach(a=>{if(a.isIntersecting){const h=a.target;h.src=h.dataset.src,h.removeAttribute("data-src"),i.unobserve(h)}})},{root:e,rootMargin:"0px 0px 100% 0px"});t.forEach(n=>i.observe(n))},C=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},k=()=>{const t=document.querySelector("span.count");t.textContent=s.querySelectorAll("img:not(.hidden").length+" / "+s.querySelectorAll("img").length},A=()=>{k(),s.classList.add("loading"),f.reset(),s.querySelectorAll("img:not(.hidden)").length===0&&s.classList.add("empty"),s.querySelectorAll("img:not(.hidden)").length===1&&(f.toggleItem({target:s.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),s.classList.add("single")),s.classList.remove("loading")},q=(t=[])=>{t=[].concat(t),s.classList.remove("empty"),s.classList.remove("single"),t.includes("search")||(document.querySelector("div.controls").classList.remove("searching"),w.value=""),t.includes("filter")||(z.value="")},O=()=>{s.classList.add("loading"),s.classList.remove("single"),q(),setTimeout(()=>{f.reset(),f.destroy(),s.querySelectorAll("img").forEach(t=>C(t)),k();for(let t=s.children.length;t>=0;t--)s.appendChild(s.children[Math.random()*t|0]);f=new m(s),s.classList.remove("loading")},200)},D=t=>{const e=w.value?200:0;q("filter"),setTimeout(()=>{b.forEach(i=>C(i.querySelector("img"),i.dataset.types.split("|").includes(t))),A()},e)},G=t=>{q("search"),b.forEach(e=>C(e.querySelector("img"),[...e.querySelectorAll("dd")].some(i=>i.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),A()},J=t=>{t.classList.contains("active")?(t.sizes="100vw",t.previousElementSibling.sizes="100vw"):(t.sizes="15vmax",t.previousElementSibling.sizes="15vmax")};U.addEventListener("click",O);z.addEventListener("change",({target:{value:t}})=>D(t));$.addEventListener("click",()=>{document.querySelector("div.controls").classList.toggle("searching"),w.focus()});w.addEventListener("change",({target:{value:t}})=>G(t));s.addEventListener("click",({target:t})=>{t===s&&t.classList.contains("empty")&&(s.classList.remove("empty"),O())});document.querySelectorAll("dl").forEach(t=>{t.addEventListener("click",e=>t.classList.toggle("show-more"))});j(s.querySelectorAll("[data-src]"),s);f=new m(s,J);s.classList.remove("loading");
