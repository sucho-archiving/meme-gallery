class w{constructor(e,i=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=i,this.init()}static resizeRow(e){if(e&&e.length>1){const i=e.map(o=>parseInt(window.getComputedStyle(o).width,10)),n=i.reduce((o,r)=>o+r,0);e.forEach((o,r)=>{o.style.width=`${i[r]/n*100}%`,o.style.height="auto"})}}init(){this.items=[...this.container.querySelectorAll("img")],this.resize(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.resize()}resize(){this.items.reduce(function(e,i){var n;const o=i.offsetTop;return e.has(o)||e.set(o,[]),(n=e.get(o))===null||n===void 0||n.push(i),e},new Map).forEach(e=>w.resizeRow(e))}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}activateItem(e){[...this.container.getElementsByClassName("active")].forEach(this.resetItem),this.expand(e),this.onItemToggleCb(e)}toggleItem(e){const i=e.target;i.classList.contains("active")?(this.shrink(!1),this.onItemToggleCb(i)):this.activateItem(i),e.stopPropagation()}expand(e){e.classList.add("active"),this.container.classList.add("zoomed");const i=window.getComputedStyle(this.container),n=parseInt(i.width,10),o=parseInt(i.height,10),r=this.container.getBoundingClientRect().top,h=window.getComputedStyle(e),S=parseInt(h.width,10),E=parseInt(h.height,10);let f=window.innerHeight;o<window.innerHeight?f=o:r>0&&(f-=r);const T=this.items.filter(a=>a.offsetTop==e.offsetTop);let c=f/E;S*c>n&&(c=n/S);let p=r-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const F=e.nextElementSibling.getBoundingClientRect().height,x=f-F;p>0&&(E*c<x&&(p-=x/2-E*c/2),r>0&&(p-=r));const R=T.slice(0,T.indexOf(e)).reduce((a,g)=>a+parseInt(window.getComputedStyle(g).width,10)*c,0),P=n/2-S*c/2-R,I=this.items.reduce(function(a,g){var u;const d=g.offsetTop;return a.has(d)||a.set(d,[]),(u=a.get(d))===null||u===void 0||u.push(g),a},new Map),v=[...I.keys()].indexOf(e.offsetTop),X=[...I.values()].map(a=>parseInt(window.getComputedStyle(a[0]).height,10));I.forEach((a,g,u)=>{const d=[...u.keys()].indexOf(g),$=Math.sign(d-v)*(c-1)*X.slice(...d>=v?[v,d]:[d,v]).reduce((l,q)=>l+q,0)-p;a.map(l=>({item:l,width:parseInt(window.getComputedStyle(l).width,10)})).forEach((l,q,j)=>{const Y=(j.slice(0,q).reduce((U,D)=>U+D.width,0)*(c-1)+P)/l.width*100,N=$/parseInt(window.getComputedStyle(l.item).height,10)*100;l.item.style.transformOrigin="0% 0%",l.item.style.transform="translate("+Y.toFixed(8)+"%, "+N.toFixed(8)+"%) scale("+c.toFixed(8)+")"})})}}let m;const s=document.getElementById("meme-wall"),z=s.querySelectorAll("picture"),V=document.querySelector("button.shuffle"),O=document.querySelector("button.show-filters"),_=document.querySelector("button.search"),L=document.querySelector("div.search input"),y=document.querySelector(".share"),G=["memeType","person","language","country","templateType"],A=Object.fromEntries(G.map(t=>[t,document.querySelector(`select.${t}`)])),J=(t,e)=>{const i=new IntersectionObserver((n,o)=>{n.forEach(r=>{if(r.isIntersecting){const h=r.target;h.src=h.dataset.src,h.removeAttribute("data-src"),i.unobserve(h)}})},{root:e,rootMargin:"0px 0px 100% 0px"});t.forEach(n=>i.observe(n))},C=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},M=()=>{const t=document.querySelector("span.count");t.textContent=s.querySelectorAll("img:not(.hidden").length+" / "+s.querySelectorAll("img").length},B=()=>{M(),s.classList.add("loading"),m.reset(),s.querySelectorAll("img:not(.hidden)").length===0&&s.classList.add("empty"),s.querySelectorAll("img:not(.hidden)").length===1&&(m.toggleItem({target:s.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),s.classList.add("single")),s.classList.remove("loading")},b=(t=[])=>{t=[].concat(t),s.classList.remove("empty"),s.classList.remove("single"),t.includes("search")||(document.querySelector("div.controls").classList.remove("searching"),L.value=""),Object.entries(A).forEach(([e,i])=>{t.includes(e)||(i.value="")})},H=()=>{s.classList.add("loading"),s.classList.remove("single"),b(),setTimeout(()=>{m.reset(),m.destroy(),s.querySelectorAll("img").forEach(t=>C(t)),M();for(let t=s.children.length;t>=0;t--)s.appendChild(s.children[Math.random()*t|0]);m=new w(s),s.classList.remove("loading")},200)},K=(t,e)=>{const i=L.value?200:0;b(t),setTimeout(()=>{z.forEach(n=>{C(n.querySelector("img"),n.dataset[t].split("|").includes(e))}),B()},i)},Q=t=>{b("search"),z.forEach(e=>C(e.querySelector("img"),[...e.querySelectorAll("dd")].some(i=>i.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),B()},k=({currentTarget:t})=>t.classList.toggle("show-more"),Z=t=>{t.classList.contains("active")?(t.sizes="100vw",t.previousElementSibling.sizes="100vw",t.nextElementSibling.addEventListener("click",k),y.style.opacity=1,history.replaceState("",document.title,window.location.pathname+"#"+t.parentElement.dataset.id)):(t.sizes="15vmax",t.previousElementSibling.sizes="15vmax",t.nextElementSibling.removeEventListener("click",k),y.style.opacity=0,history.replaceState("",document.title,window.location.pathname))},W=t=>{const e=document.querySelector(`[data-id='${t}'] img`);if(!e)return!1;e.previousElementSibling.scrollIntoView(),m.activateItem(e)};window.addEventListener("hashchange",()=>{const t=window.location.hash.substring(1);document.querySelector(`[data-id='${t}'] img`)?.classList.contains("active")||W(t)});V.addEventListener("click",H);Object.entries(A).forEach(([t,e])=>e.addEventListener("change",({target:{value:i}})=>K(t,i)));O.addEventListener("click",()=>{document.querySelector("div.more-filters").classList.toggle("show"),O.classList.toggle("on")});_.addEventListener("click",()=>{document.querySelector("div.controls").classList.toggle("searching"),L.focus()});L.addEventListener("change",({target:{value:t}})=>Q(t));s.addEventListener("click",({target:t})=>{t===s&&t.classList.contains("empty")&&(s.classList.remove("empty"),H())});navigator.share?y.addEventListener("click",t=>{t.preventDefault(),navigator.share({title:"From the SUCHO Meme Wall",url:window.location}).catch(e=>{})}):y.classList.add("disabled");J(s.querySelectorAll("[data-src]"),s);m=new w(s,Z);window.location.hash&&W(window.location.hash.substring(1));s.classList.remove("loading");
