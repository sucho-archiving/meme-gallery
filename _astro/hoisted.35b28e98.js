class k{constructor(e,s=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=s,this.init()}static resizeRow(e){if(e&&e.length>1){const s=e.map(a=>parseInt(window.getComputedStyle(a).width,10)),i=s.reduce((a,n)=>a+n,0);e.forEach((a,n)=>{a.style.width=`${s[n]/i*100}%`,a.style.height="auto"})}}init(){this.items=[...this.container.querySelectorAll("img")],this.initializeRows(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.initializeRows()}initializeRows(){this.rows=this.items.reduce((e,s)=>{s.classList.add("offcanvas");const i=s.offsetTop;return e.has(i)?(e.get(i).push(s),e):e.set(i,[s])},new Map),this.rows=[...this.rows.values()],this.layoutObserver=new IntersectionObserver(e=>{let s=0;e.forEach(i=>{if(i.isIntersecting){const a=this.rows[i.target.rowIndex];k.resizeRow(a),a.forEach((n,d)=>{const h=d*.05+s*.1;n.style.transitionDelay=`${h}s`,n.classList.remove("offcanvas"),setTimeout(()=>{n.style.transitionDelay="0s"},h*1e3)}),s++}else this.container.classList.contains("zoomed")||this.rows[i.target.rowIndex].forEach(n=>{n.classList.add("offcanvas")})})},{rootMargin:"200px 0px 200px 0px"}),this.rows.forEach((e,s)=>{e.forEach(i=>i.rowIndex=s),this.layoutObserver.observe(e[0])})}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}activateItem(e){[...this.container.getElementsByClassName("active")].forEach(this.resetItem),this.expand(e),this.onItemToggleCb(e)}toggleItem(e){const s=e.target;s.classList.contains("active")?(this.shrink(!1),this.onItemToggleCb(s)):this.activateItem(s),e.stopPropagation()}expand(e){e.classList.add("active"),e.classList.remove("offcanvas"),this.container.classList.add("zoomed");const s=window.getComputedStyle(this.container),i=parseInt(s.width,10),a=parseInt(s.height,10),n=this.container.getBoundingClientRect().top,d=window.getComputedStyle(e),h=parseInt(d.width,10),q=parseInt(d.height,10);let v=window.innerHeight;a<window.innerHeight?v=a:n>0&&(v-=n);const O=this.rows[e.rowIndex];let r=v/q;h*r>i&&(r=i/h);let p=n-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const j=e.nextElementSibling.getBoundingClientRect().height,z=v-j;p>0&&(q*r<z&&(p-=z/2-q*r/2),n>0&&(p-=n));const D=O.slice(0,O.indexOf(e)).reduce((c,m)=>c+parseInt(window.getComputedStyle(m).width,10)*r,0),N=i/2-h*r/2-D,w=e.rowIndex,X=this.rows.map(c=>parseInt(window.getComputedStyle(c[0]).height,10));this.rows.forEach((c,m)=>{const[Y,U]=m>=w?[w,m]:[m,w];let y=0;for(let u=Y;u<U;u++)y+=X[u];y=Math.sign(m-w)*(r-1)*y-p;let A=0;c.forEach(u=>{let{width:L,height:C}=window.getComputedStyle(u);L=parseInt(L,10),C=parseInt(C,10);const V=(A*(r-1)+N)/L*100,G=y/C*100;u.dataset.transform=`translate(${V.toFixed(8)}%, ${G.toFixed(8)}%) scale(${r.toFixed(8)})`,A+=L})}),this.items.forEach(c=>{c.classList.contains("offcanvas")||(c.style.transform=c.dataset.transform)})}next(){let s=this.items.find(i=>i.classList.contains("active")).parentElement.nextElementSibling?.children[0];for(;s&&s.classList.contains("hidden");)s=s.parentElement.nextElementSibling?.children[0];s&&this.activateItem(s)}previous(){let s=this.items.find(i=>i.classList.contains("active")).parentElement.previousElementSibling?.children[0];for(;s&&s.classList.contains("hidden");)s=s.parentElement.previousElementSibling?.children[0];s&&this.activateItem(s)}}const J=CSS.supports("selector(:has(img))");let l;const o=document.getElementById("meme-wall"),E=o.querySelectorAll("picture"),K=document.querySelector("button.reset-wall"),b=document.querySelector("button.show-filters"),Q=document.querySelector("button.search"),f=document.querySelector("div.search input"),x=document.getElementById("overlay-buttons"),Z=["memeType","person","language","country","templateType"],B=Object.fromEntries(Z.map(t=>[t,document.querySelector(`div#${t}`)]));let g={};const I=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},_=()=>{const t=document.querySelector("div.count span"),e=o.querySelectorAll("img:not(.hidden)").length,s=o.querySelectorAll("img").length;t.textContent=e+" / "+s,t.parentElement.classList.toggle("show-reset",e!==s)},T=()=>{_(),x.classList.remove("active"),l.reset(),o.querySelectorAll("img:not(.hidden)").length===0&&o.classList.add("empty"),o.querySelectorAll("img:not(.hidden)").length===1&&(l.toggleItem({target:o.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),o.classList.add("single")),J||setTimeout(()=>{document.querySelector(".loader").style.opacity=+!!o.querySelectorAll("img:not(.hidden).offcanvas").length},0)},ee=()=>{o.classList.remove("empty"),o.classList.remove("single"),history.replaceState("",document.title,window.location.pathname),Object.values(B).forEach(t=>{t.dispatchEvent(new Event("clear"))}),g={},P()},M=(t=!0)=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),history.replaceState("",document.title,window.location.pathname),document.querySelector("div.controls").classList.remove("searching"),f.value="",t&&setTimeout(()=>{E.forEach(e=>{I(e.querySelector("img"),!0)}),T()},200)},F=()=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),ee()},P=()=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),M(!1);const t=f.value?200:0,e=i=>Object.entries(g).some(([a,n])=>n.some(d=>i.dataset[a].split("|").includes(d))),s=Object.entries(g).reduce((i,[a,n])=>i+=a==="memeType"?0:n.length,0);b.dataset.activeFilterCount=s,b.classList.toggle("show-indicator",s>0),setTimeout(()=>{Object.values(g).flat().length?E.forEach(i=>{I(i.querySelector("img"),e(i))}):E.forEach(i=>{I(i.querySelector("img"),!0)}),T()},t)},te=t=>{[...E].filter(e=>!e.querySelector("img").classList.contains("hidden")).forEach(e=>I(e.querySelector("img"),[...e.querySelectorAll("dd")].some(s=>s.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),T()},H=({currentTarget:t})=>t.classList.toggle("show-more"),se=t=>{t.classList.contains("active")?(t.sizes="100vw",t.nextElementSibling.addEventListener("click",H),x.classList.add("active"),history.replaceState("",document.title,window.location.pathname+"#"+t.parentElement.dataset.id)):(t.sizes="15vmax",t.nextElementSibling.removeEventListener("click",H),x.classList.remove("active"),history.replaceState("",document.title,window.location.pathname))},R=t=>{const e=document.querySelector(`[data-id='${t}'] img`);if(!e)return!1;const s=new MutationObserver(()=>{e.classList.contains("offcanvas")||(s.disconnect(),l.activateItem(e))});s.observe(e,{attributes:!0}),e.scrollIntoView({behavior:"instant"})};window.addEventListener("hashchange",()=>{const t=window.location.hash.substring(1);document.querySelector(`[data-id='${t}'] img`)?.classList.contains("active")||R(t)});K.addEventListener("click",F);Object.entries(B).forEach(([t,e])=>{e.addEventListener("updated",({detail:s})=>{g[t]=s,P()})});b.addEventListener("click",()=>{document.querySelector("div.more-filters").classList.toggle("show"),b.classList.toggle("on")});Q.addEventListener("click",()=>{const t=document.querySelector("div.controls");if(t.classList.contains("searching")){if(f.value==""){t.classList.remove("searching");return}M()}else t.classList.add("searching"),f.focus()});f.addEventListener("change",({target:{value:t}})=>te(t));o.addEventListener("click",({target:t})=>{t===o&&t.classList.contains("empty")&&(o.classList.remove("empty"),F())});const S=t=>{t.classList.add("flash");const e=t.getAnimations()[0];e!==void 0?e.onfinish=()=>t.classList.remove("flash"):t.classList.remove("flash")};window.addEventListener("keydown",t=>{if(o.classList.contains("zoomed"))switch(t.key){case"Escape":{S(document.querySelector('[aria-label="Close"]')),l.toggleItem({target:o.querySelector("img.active"),stopPropagation:()=>{}});break}case"ArrowLeft":case"ArrowUp":S(document.querySelector('[aria-label="Previous"]')),l.previous();break;case"ArrowRight":case"ArrowDown":S(document.querySelector('[aria-label="Next"]')),l.next();break}});const W=()=>document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`);window.addEventListener("resize",W);W();l=new k(o,se);window.location.hash&&R(window.location.hash.substring(1));self.memewall=l;self.wallContainer=o;self.flash=S;const $=document.querySelector('[aria-label="Share"]');navigator.share?$.addEventListener("click",t=>{t.preventDefault(),navigator.share({title:"From the SUCHO Meme Wall",url:window.location.toString()}).catch(e=>{})}):$.classList.add("disabled");document.querySelector('[aria-label="Previous"]').addEventListener("click",function(){memewall.previous(),flash(this)});document.querySelector('[aria-label="Next"]').addEventListener("click",function(){memewall.next(),flash(this)});document.querySelector('[aria-label="Close"]').addEventListener("click",function(){flash(this),memewall.toggleItem({target:wallContainer.querySelector("img.active"),stopPropagation:()=>{}})});
