class m{constructor(e,s=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=s,this.init()}static calcRowWidth(e){return e.reduce((s,n)=>s+parseInt(window.getComputedStyle(n).width,10),0)}static resizeRow(e,s){!e||(e.length>1?e.forEach(n=>{n.style.width=`${parseInt(window.getComputedStyle(n).width,10)/s*100}%`,n.style.height="auto"}):(e[0].style.width="100%",e[0].style.height="auto"))}init(){this.items=[...this.container.querySelectorAll("img")],this.resize(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(),this.resize()}resize(){this.items.reduce(function(e,s){var n;const c=s.offsetTop;return e.has(c)||e.set(c,[]),(n=e.get(c))===null||n===void 0||n.push(s),e},new Map).forEach(e=>m.resizeRow(e,m.calcRowWidth(e)))}shrink(){this.container.classList.contains("single")||(this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem))}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}toggleItem(e){const s=e.target;s.classList.contains("active")?this.shrink():([...this.container.getElementsByClassName("active")].forEach(n=>n.classList.remove("active")),this.expand(s)),this.onItemToggleCb(s),e.stopPropagation()}expand(e){e.classList.add("active"),this.container.classList.add("zoomed");const s=window.getComputedStyle(this.container),n=parseInt(s.width,10),c=parseInt(s.height,10),a=this.container.getBoundingClientRect().top,h=window.getComputedStyle(e),L=parseInt(h.width,10),C=parseInt(h.height,10);let p=window.innerHeight;c<window.innerHeight?p=c:a>0&&(p-=a);const q=this.items.filter(o=>o.offsetTop==e.offsetTop);let l=p/C;L*l>n&&(l=n/L);let v=a-this.container.offsetTop-this.container.scrollTop+e.offsetTop;v>0&&(c<window.innerHeight&&(v-=p/2-C*l/2),a>0&&(v-=a));const A=q.slice(0,q.indexOf(e)).reduce((o,g)=>o+parseInt(window.getComputedStyle(g).width,10)*l,0),H=n/2-L*l/2-A,S=this.items.reduce(function(o,g){var u;const d=g.offsetTop;return o.has(d)||o.set(d,[]),(u=o.get(d))===null||u===void 0||u.push(g),o},new Map),y=[...S.keys()].indexOf(e.offsetTop),B=[...S.values()].map(o=>parseInt(window.getComputedStyle(o[0]).height,10));S.forEach((o,g,u)=>{const d=[...u.keys()].indexOf(g),M=Math.sign(d-y)*(l-1)*B.slice(...d>=y?[y,d]:[d,y]).reduce((r,I)=>r+I,0)-v;o.map(r=>({item:r,width:parseInt(window.getComputedStyle(r).width,10)})).forEach((r,I,R)=>{const W=(R.slice(0,I).reduce((P,X)=>P+X.width,0)*(l-1)+H)/r.width*100,F=M/parseInt(window.getComputedStyle(r.item).height,10)*100;r.item.style.transformOrigin="0% 0%",r.item.style.transform="translate("+W.toFixed(8)+"%, "+F.toFixed(8)+"%) scale("+l.toFixed(8)+")"})})}}let f;const i=document.getElementById("meme-wall"),x=i.querySelectorAll("[data-types]"),T=document.querySelector("select"),Y=document.querySelector("button.shuffle"),N=document.querySelector("button.search"),w=document.querySelector("div.search input"),U=(t,e)=>{const s=new IntersectionObserver((n,c)=>{n.forEach(a=>{if(a.isIntersecting){const h=a.target;h.src=h.dataset.src,h.removeAttribute("data-src"),s.unobserve(h)}})},{root:e,rootMargin:"0px 0px 100% 0px"});t.forEach(n=>s.observe(n))},E=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},z=()=>{const t=document.querySelector("span.count");t.textContent=i.querySelectorAll("img:not(.hidden").length+" / "+i.querySelectorAll("img").length},b=()=>{z(),i.classList.add("loading"),i.classList.remove("single"),f.reset(),i.querySelectorAll("img:not(.hidden)").length===1&&(f.toggleItem({target:i.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),i.classList.add("single")),i.classList.remove("loading")},k=()=>{document.querySelector("div.controls").classList.remove("searching"),w.value=""},O=()=>{T.value=""},$=()=>{i.classList.add("loading"),i.classList.remove("single"),k(),O(),setTimeout(()=>{f.reset(),f.destroy(),i.querySelectorAll("img").forEach(t=>E(t)),z();for(let t=i.children.length;t>=0;t--)i.appendChild(i.children[Math.random()*t|0]);f=new m(i),i.classList.remove("loading")},200)},j=t=>{const e=w.value?200:0;k(),setTimeout(()=>{x.forEach(s=>E(s.querySelector("img"),s.dataset.types.split("|").includes(t))),b()},e)},D=t=>{O(),x.forEach(e=>E(e.querySelector("img"),[...e.querySelectorAll("dd")].some(s=>s.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),b()},G=t=>{t.classList.contains("active")?(t.sizes="100vw",t.previousElementSibling.sizes="100vw"):(t.sizes="15vmax",t.previousElementSibling.sizes="15vmax")};Y.addEventListener("click",$);T.addEventListener("change",({target:{value:t}})=>j(t));N.addEventListener("click",()=>{document.querySelector("div.controls").classList.toggle("searching"),w.focus()});w.addEventListener("change",({target:{value:t}})=>D(t));U(i.querySelectorAll("[data-src]"),i);f=new m(i,G);i.classList.remove("loading");
