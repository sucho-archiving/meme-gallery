class f{constructor(e,i=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=i,this.init()}static calcRowWidth(e){return e.reduce((i,n)=>i+parseInt(window.getComputedStyle(n).width,10),0)}static resizeRow(e,i){!e||e.length>1&&e.forEach(n=>{n.style.width=`${parseInt(window.getComputedStyle(n).width,10)/i*100}%`,n.style.height="auto"})}init(){this.items=[...this.container.querySelectorAll("img")],this.resize(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.resize()}resize(){this.items.reduce(function(e,i){var n;const d=i.offsetTop;return e.has(d)||e.set(d,[]),(n=e.get(d))===null||n===void 0||n.push(i),e},new Map).forEach(e=>f.resizeRow(e,f.calcRowWidth(e)))}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}toggleItem(e){const i=e.target;i.classList.contains("active")?this.shrink(!1):([...this.container.getElementsByClassName("active")].forEach(n=>n.classList.remove("active")),this.expand(i)),this.onItemToggleCb(i),e.stopPropagation()}expand(e){e.classList.add("active"),this.container.classList.add("zoomed");const i=window.getComputedStyle(this.container),n=parseInt(i.width,10),d=parseInt(i.height,10),a=this.container.getBoundingClientRect().top,h=window.getComputedStyle(e),L=parseInt(h.width,10),S=parseInt(h.height,10);let p=window.innerHeight;d<window.innerHeight?p=d:a>0&&(p-=a);const T=this.items.filter(o=>o.offsetTop==e.offsetTop);let r=p/S;L*r>n&&(r=n/L);let v=a-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const H=e.nextElementSibling.getBoundingClientRect().height,b=p-H;v>0&&(S*r<b&&(v-=b/2-S*r/2),a>0&&(v-=a));const R=T.slice(0,T.indexOf(e)).reduce((o,g)=>o+parseInt(window.getComputedStyle(g).width,10)*r,0),M=n/2-L*r/2-R,E=this.items.reduce(function(o,g){var m;const l=g.offsetTop;return o.has(l)||o.set(l,[]),(m=o.get(l))===null||m===void 0||m.push(g),o},new Map),y=[...E.keys()].indexOf(e.offsetTop),W=[...E.values()].map(o=>parseInt(window.getComputedStyle(o[0]).height,10));E.forEach((o,g,m)=>{const l=[...m.keys()].indexOf(g),F=Math.sign(l-y)*(r-1)*W.slice(...l>=y?[y,l]:[l,y]).reduce((c,I)=>c+I,0)-v;o.map(c=>({item:c,width:parseInt(window.getComputedStyle(c).width,10)})).forEach((c,I,P)=>{const X=(P.slice(0,I).reduce((Y,N)=>Y+N.width,0)*(r-1)+M)/c.width*100,j=F/parseInt(window.getComputedStyle(c.item).height,10)*100;c.item.style.transformOrigin="0% 0%",c.item.style.transform="translate("+X.toFixed(8)+"%, "+j.toFixed(8)+"%) scale("+r.toFixed(8)+")"})})}}let u;const s=document.getElementById("meme-wall"),O=s.querySelectorAll("picture"),$=document.querySelector("button.shuffle"),x=document.querySelector("button.show-filters"),U=document.querySelector("button.search"),w=document.querySelector("div.search input"),D=["memeType","person","language","country","templateType"],k=Object.fromEntries(D.map(t=>[t,document.querySelector(`select.${t}`)])),G=(t,e)=>{const i=new IntersectionObserver((n,d)=>{n.forEach(a=>{if(a.isIntersecting){const h=a.target;h.src=h.dataset.src,h.removeAttribute("data-src"),i.unobserve(h)}})},{root:e,rootMargin:"0px 0px 100% 0px"});t.forEach(n=>i.observe(n))},q=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},z=()=>{const t=document.querySelector("span.count");t.textContent=s.querySelectorAll("img:not(.hidden").length+" / "+s.querySelectorAll("img").length},A=()=>{z(),s.classList.add("loading"),u.reset(),s.querySelectorAll("img:not(.hidden)").length===0&&s.classList.add("empty"),s.querySelectorAll("img:not(.hidden)").length===1&&(u.toggleItem({target:s.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),s.classList.add("single")),s.classList.remove("loading")},C=(t=[])=>{t=[].concat(t),s.classList.remove("empty"),s.classList.remove("single"),t.includes("search")||(document.querySelector("div.controls").classList.remove("searching"),w.value=""),Object.entries(k).forEach(([e,i])=>{t.includes(e)||(i.value="")})},B=()=>{s.classList.add("loading"),s.classList.remove("single"),C(),setTimeout(()=>{u.reset(),u.destroy(),s.querySelectorAll("img").forEach(t=>q(t)),z();for(let t=s.children.length;t>=0;t--)s.appendChild(s.children[Math.random()*t|0]);u=new f(s),s.classList.remove("loading")},200)},J=(t,e)=>{const i=w.value?200:0;C(t),setTimeout(()=>{O.forEach(n=>{q(n.querySelector("img"),n.dataset[t].split("|").includes(e))}),A()},i)},K=t=>{C("search"),O.forEach(e=>q(e.querySelector("img"),[...e.querySelectorAll("dd")].some(i=>i.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),A()},Q=t=>{t.classList.contains("active")?(t.sizes="100vw",t.previousElementSibling.sizes="100vw"):(t.sizes="15vmax",t.previousElementSibling.sizes="15vmax")};$.addEventListener("click",B);Object.entries(k).forEach(([t,e])=>e.addEventListener("change",({target:{value:i}})=>J(t,i)));x.addEventListener("click",()=>{document.querySelector("div.more-filters").classList.toggle("show"),x.classList.toggle("on")});U.addEventListener("click",()=>{document.querySelector("div.controls").classList.toggle("searching"),w.focus()});w.addEventListener("change",({target:{value:t}})=>K(t));s.addEventListener("click",({target:t})=>{t===s&&t.classList.contains("empty")&&(s.classList.remove("empty"),B())});document.querySelectorAll("dl").forEach(t=>{t.addEventListener("click",e=>t.classList.toggle("show-more"))});G(s.querySelectorAll("[data-src]"),s);u=new f(s,Q);s.classList.remove("loading");
