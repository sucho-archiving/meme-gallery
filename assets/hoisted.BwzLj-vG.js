class O{constructor(e,s=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=s,this.init()}static resizeRow(e){if(e&&e.length>1){const s=e.map(a=>parseInt(window.getComputedStyle(a).width,10)),i=s.reduce((a,n)=>a+n,0);e.forEach((a,n)=>{a.style.width=`${s[n]/i*100}%`,a.style.height="auto"})}}init(){this.items=[...this.container.querySelectorAll("img")],this.initializeRows(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.initializeRows()}initializeRows(){this.rows=this.items.reduce((e,s)=>{s.classList.add("offcanvas");const i=s.offsetTop;return e.has(i)?(e.get(i).push(s),e):e.set(i,[s])},new Map),this.rows=[...this.rows.values()],this.layoutObserver=new IntersectionObserver(e=>{let s=0;e.forEach(i=>{if(i.isIntersecting){const a=this.rows[i.target.rowIndex];O.resizeRow(a),a.forEach((n,m)=>{const d=m*.05+s*.1;n.style.transitionDelay=`${d}s`,n.classList.remove("offcanvas"),setTimeout(()=>{n.style.transitionDelay="0s"},d*1e3)}),s++}else this.container.classList.contains("zoomed")||this.rows[i.target.rowIndex].forEach(n=>{n.classList.add("offcanvas")})})},{rootMargin:"200px 0px 200px 0px"}),this.rows.forEach((e,s)=>{e.forEach(i=>i.rowIndex=s),this.layoutObserver.observe(e[0])})}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}activateItem(e){[...this.container.getElementsByClassName("active")].forEach(this.resetItem),this.expand(e),this.onItemToggleCb(e)}toggleItem(e){const s=e.target;s.classList.contains("active")?(this.shrink(!1),this.onItemToggleCb(s)):this.activateItem(s),e.stopPropagation()}expand(e){e.classList.add("active"),e.classList.remove("offcanvas"),this.container.classList.add("zoomed");const s=window.getComputedStyle(this.container),i=parseInt(s.width,10),a=parseInt(s.height,10),n=this.container.getBoundingClientRect().top,m=window.getComputedStyle(e),d=parseInt(m.width,10),C=parseInt(m.height,10);let w=window.innerHeight;a<window.innerHeight?w=a:n>0&&(w-=n);const A=this.rows[e.rowIndex];let r=w/C;d*r>i&&(r=i/d),e.sizes=`${d*r}px`;let y=n-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const N=e.nextElementSibling.getBoundingClientRect().height,H=w-N;y>0&&(C*r<H&&(y-=H/2-C*r/2),n>0&&(y-=n));const X=A.slice(0,A.indexOf(e)).reduce((c,u)=>c+parseInt(window.getComputedStyle(u).width,10)*r,0),Y=i/2-d*r/2-X,L=e.rowIndex,U=this.rows.map(c=>parseInt(window.getComputedStyle(c[0]).height,10));this.rows.forEach((c,u)=>{const[V,G]=u>=L?[L,u]:[u,L];let E=0;for(let g=V;g<G;g++)E+=U[g];E=Math.sign(u-L)*(r-1)*E-y;let $=0;c.forEach(g=>{let{width:S,height:k}=window.getComputedStyle(g);S=parseInt(S,10),k=parseInt(k,10);const J=($*(r-1)+Y)/S*100,K=E/k*100;g.dataset.transform=`translate(${J.toFixed(8)}%, ${K.toFixed(8)}%) scale(${r.toFixed(8)})`,$+=S})}),this.items.forEach(c=>{c.classList.contains("offcanvas")||(c.style.transform=c.dataset.transform)})}next(){let s=this.items.find(i=>i.classList.contains("active")).parentElement.nextElementSibling?.children[0];for(;s&&s.classList.contains("hidden");)s=s.parentElement.nextElementSibling?.children[0];s&&this.activateItem(s)}previous(){let s=this.items.find(i=>i.classList.contains("active")).parentElement.previousElementSibling?.children[0];for(;s&&s.classList.contains("hidden");)s=s.parentElement.previousElementSibling?.children[0];s&&this.activateItem(s)}}const Q=CSS.supports("selector(:has(img))");let l;const o=document.getElementById("meme-wall"),b=o.querySelectorAll("picture"),Z=document.querySelector("button.reset-wall"),q=document.querySelector("button.show-filters"),_=document.querySelector("button.search"),p=document.querySelector("div.search input"),T=document.getElementById("overlay-buttons"),h=document.getElementById("popup"),ee=["memeType","person","language","country","templateType"],P=Object.fromEntries(ee.map(t=>[t,document.querySelector(`div#${t}`)]));let f={};const x=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},te=()=>{const t=document.querySelector("div.count span"),e=o.querySelectorAll("img:not(.hidden)").length,s=o.querySelectorAll("img").length;t.textContent=e+" / "+s,t.parentElement.classList.toggle("show-reset",e!==s)},z=()=>{te(),T.classList.remove("active"),l.reset(),o.querySelectorAll("img:not(.hidden)").length===0&&o.classList.add("empty"),o.querySelectorAll("img:not(.hidden)").length===1&&(l.toggleItem({target:o.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),o.classList.add("single")),Q||setTimeout(()=>{document.querySelector(".loader").style.opacity=+!!o.querySelectorAll("img:not(.hidden).offcanvas").length},0)},se=()=>{o.classList.remove("empty"),o.classList.remove("single"),history.replaceState("",document.title,window.location.pathname),Object.values(P).forEach(t=>{t.dispatchEvent(new Event("clear"))}),f={},W()},F=(t=!0)=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),history.replaceState("",document.title,window.location.pathname),document.querySelector("div.controls").classList.remove("searching"),p.value="",t&&setTimeout(()=>{b.forEach(e=>{x(e.querySelector("img"),!0)}),z()},200)},R=()=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),se()},W=()=>{o.classList.remove("empty"),o.classList.remove("single"),o.classList.remove("zoomed"),F(!1);const t=p.value?200:0,e=i=>Object.entries(f).some(([a,n])=>n.some(m=>i.dataset[a].split("|").includes(m))),s=Object.entries(f).reduce((i,[a,n])=>i+=a==="memeType"?0:n.length,0);q.dataset.activeFilterCount=s,q.classList.toggle("show-indicator",s>0),setTimeout(()=>{Object.values(f).flat().length?b.forEach(i=>{x(i.querySelector("img"),e(i))}):b.forEach(i=>{x(i.querySelector("img"),!0)}),z()},t)},ie=t=>{[...b].filter(e=>!e.querySelector("img").classList.contains("hidden")).forEach(e=>x(e.querySelector("img"),[...e.querySelectorAll("dd")].some(s=>s.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),z()},B=({currentTarget:t})=>t.classList.toggle("show-more"),oe=t=>{t.classList.contains("active")?(t.nextElementSibling.addEventListener("click",B),T.classList.add("active"),history.replaceState("",document.title,window.location.pathname+"#"+t.parentElement.dataset.id)):(t.nextElementSibling.removeEventListener("click",B),T.classList.remove("active"),history.replaceState("",document.title,window.location.pathname))},j=t=>{const e=document.querySelector(`[data-id='${t}'] img`);if(!e)return!1;const s=new MutationObserver(()=>{e.classList.contains("offcanvas")||(s.disconnect(),l.activateItem(e))});s.observe(e,{attributes:!0}),e.scrollIntoView({behavior:"instant"})};window.addEventListener("hashchange",()=>{const t=window.location.hash.substring(1);document.querySelector(`[data-id='${t}'] img`)?.classList.contains("active")||j(t)});Z.addEventListener("click",R);Object.entries(P).forEach(([t,e])=>{e.addEventListener("updated",({detail:s})=>{f[t]=s,W()})});q.addEventListener("click",()=>{document.querySelector("div.more-filters").classList.toggle("show"),q.classList.toggle("on")});_.addEventListener("click",()=>{const t=document.querySelector("div.controls");if(t.classList.contains("searching")){if(p.value==""){t.classList.remove("searching");return}F()}else t.classList.add("searching"),p.focus()});p.addEventListener("change",({target:{value:t}})=>ie(t));o.addEventListener("click",({target:t})=>{t===o&&t.classList.contains("empty")&&(o.classList.remove("empty"),R())});const v=h.querySelector("iframe");v.addEventListener("load",()=>{v.style.height=v.contentDocument.body.offsetHeight+40+"px"});document.querySelectorAll("a.show-content-type").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),fetch(t).then(s=>s.text()).then(s=>{v.srcdoc=s,h.classList.add("active")})})});h.addEventListener("click",t=>{t.target===h&&(h.classList.remove("active"),v.style.height=0)});const I=t=>{t.classList.add("flash");const e=t.getAnimations()[0];e!==void 0?e.onfinish=()=>t.classList.remove("flash"):t.classList.remove("flash")};window.addEventListener("keydown",t=>{if(h.classList.contains("active")){t.key=="Escape"&&h.classList.remove("active");return}if(o.classList.contains("zoomed"))switch(t.key){case"Escape":{I(document.querySelector('[aria-label="Close"]')),l.toggleItem({target:o.querySelector("img.active"),stopPropagation:()=>{}});break}case"ArrowLeft":case"ArrowUp":I(document.querySelector('[aria-label="Previous"]')),l.previous();break;case"ArrowRight":case"ArrowDown":I(document.querySelector('[aria-label="Next"]')),l.next();break}});const D=()=>document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`);window.addEventListener("resize",D);D();l=new O(o,oe);window.location.hash&&j(window.location.hash.substring(1));self.memewall=l;self.wallContainer=o;self.flash=I;const M=document.querySelector('[aria-label="Share"]');navigator.share?M.addEventListener("click",t=>{t.preventDefault(),navigator.share({title:"From the SUCHO Meme Wall",url:window.location.toString()}).catch(e=>{})}):M.classList.add("disabled");document.querySelector('[aria-label="Previous"]').addEventListener("click",function(){memewall.previous(),flash(this)});document.querySelector('[aria-label="Next"]').addEventListener("click",function(){memewall.next(),flash(this)});document.querySelector('[aria-label="Close"]').addEventListener("click",function(){flash(this),memewall.toggleItem({target:wallContainer.querySelector("img.active"),stopPropagation:()=>{}})});
