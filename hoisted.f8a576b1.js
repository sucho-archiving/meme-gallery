class y{constructor(e,i=()=>{}){this.container=typeof e=="string"?document.querySelector(e):e,this.onItemToggleCb=i,this.init()}static resizeRow(e){if(!!e&&e.length>1){const i=e.map(o=>parseInt(window.getComputedStyle(o).width,10)),n=i.reduce((o,r)=>o+r,0);e.forEach((o,r)=>{o.style.width=`${i[r]/n*100}%`,o.style.height="auto"})}}init(){this.items=[...this.container.querySelectorAll("img")],this.resize(),this.container.classList.remove("loading"),this.shrink=this.shrink.bind(this),this.toggleItem=this.toggleItem.bind(this),this.container.addEventListener("click",this.shrink),this.items.forEach(e=>e.addEventListener("click",this.toggleItem))}destroy(){this.container.removeEventListener("click",this.shrink),this.items.forEach(e=>e.removeEventListener("click",this.toggleItem))}reset(){[...this.container.getElementsByClassName("active")].forEach(e=>{e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}),this.shrink(!1),this.resize()}resize(){this.items.reduce(function(e,i){var n;const o=i.offsetTop;return e.has(o)||e.set(o,[]),(n=e.get(o))===null||n===void 0||n.push(i),e},new Map).forEach(e=>y.resizeRow(e))}shrink(e){if(!e||e&&e.target===this.container){if(this.container.classList.contains("single"))return;this.container.classList.remove("zoomed"),this.items.forEach(this.resetItem)}}resetItem(e){e.style.transform="translate(0, 0) scale(1)",e.classList.remove("active")}toggleItem(e){const i=e.target;i.classList.contains("active")?this.shrink(!1):([...this.container.getElementsByClassName("active")].forEach(n=>n.classList.remove("active")),this.expand(i)),this.onItemToggleCb(i),e.stopPropagation()}expand(e){e.classList.add("active"),this.container.classList.add("zoomed");const i=window.getComputedStyle(this.container),n=parseInt(i.width,10),o=parseInt(i.height,10),r=this.container.getBoundingClientRect().top,h=window.getComputedStyle(e),w=parseInt(h.width,10),S=parseInt(h.height,10);let u=window.innerHeight;o<window.innerHeight?u=o:r>0&&(u-=r);const T=this.items.filter(c=>c.offsetTop==e.offsetTop);let a=u/S;w*a>n&&(a=n/w);let p=r-this.container.offsetTop-this.container.scrollTop+e.offsetTop;const H=e.nextElementSibling.getBoundingClientRect().height,b=u-H;p>0&&(S*a<b&&(p-=b/2-S*a/2),r>0&&(p-=r));const M=T.slice(0,T.indexOf(e)).reduce((c,g)=>c+parseInt(window.getComputedStyle(g).width,10)*a,0),W=n/2-w*a/2-M,E=this.items.reduce(function(c,g){var f;const d=g.offsetTop;return c.has(d)||c.set(d,[]),(f=c.get(d))===null||f===void 0||f.push(g),c},new Map),v=[...E.keys()].indexOf(e.offsetTop),R=[...E.values()].map(c=>parseInt(window.getComputedStyle(c[0]).height,10));E.forEach((c,g,f)=>{const d=[...f.keys()].indexOf(g),F=Math.sign(d-v)*(a-1)*R.slice(...d>=v?[v,d]:[d,v]).reduce((l,I)=>l+I,0)-p;c.map(l=>({item:l,width:parseInt(window.getComputedStyle(l).width,10)})).forEach((l,I,P)=>{const X=(P.slice(0,I).reduce((Y,N)=>Y+N.width,0)*(a-1)+W)/l.width*100,j=F/parseInt(window.getComputedStyle(l.item).height,10)*100;l.item.style.transformOrigin="0% 0%",l.item.style.transform="translate("+X.toFixed(8)+"%, "+j.toFixed(8)+"%) scale("+a.toFixed(8)+")"})})}}let m;const s=document.getElementById("meme-wall"),O=s.querySelectorAll("picture"),$=document.querySelector("button.shuffle"),x=document.querySelector("button.show-filters"),U=document.querySelector("button.search"),L=document.querySelector("div.search input"),_=["memeType","person","language","country","templateType"],k=Object.fromEntries(_.map(t=>[t,document.querySelector(`select.${t}`)])),D=(t,e)=>{const i=new IntersectionObserver((n,o)=>{n.forEach(r=>{if(r.isIntersecting){const h=r.target;h.src=h.dataset.src,h.removeAttribute("data-src"),i.unobserve(h)}})},{root:e,rootMargin:"0px 0px 100% 0px"});t.forEach(n=>i.observe(n))},q=(t,e=!0)=>{e?(t.style.removeProperty("width"),t.style.removeProperty("height"),t.classList.remove("hidden")):t.classList.add("hidden")},z=()=>{const t=document.querySelector("span.count");t.textContent=s.querySelectorAll("img:not(.hidden").length+" / "+s.querySelectorAll("img").length},A=()=>{z(),s.classList.add("loading"),m.reset(),s.querySelectorAll("img:not(.hidden)").length===0&&s.classList.add("empty"),s.querySelectorAll("img:not(.hidden)").length===1&&(m.toggleItem({target:s.querySelector("img:not(.hidden)"),stopPropagation:()=>{}}),s.classList.add("single")),s.classList.remove("loading")},C=(t=[])=>{t=[].concat(t),s.classList.remove("empty"),s.classList.remove("single"),t.includes("search")||(document.querySelector("div.controls").classList.remove("searching"),L.value=""),Object.entries(k).forEach(([e,i])=>{t.includes(e)||(i.value="")})},B=()=>{s.classList.add("loading"),s.classList.remove("single"),C(),setTimeout(()=>{m.reset(),m.destroy(),s.querySelectorAll("img").forEach(t=>q(t)),z();for(let t=s.children.length;t>=0;t--)s.appendChild(s.children[Math.random()*t|0]);m=new y(s),s.classList.remove("loading")},200)},G=(t,e)=>{const i=L.value?200:0;C(t),setTimeout(()=>{O.forEach(n=>{q(n.querySelector("img"),n.dataset[t].split("|").includes(e))}),A()},i)},J=t=>{C("search"),O.forEach(e=>q(e.querySelector("img"),[...e.querySelectorAll("dd")].some(i=>i.textContent.toLocaleLowerCase().includes(t.toLocaleLowerCase())))),A()},K=t=>{t.classList.contains("active")?(t.sizes="100vw",t.previousElementSibling.sizes="100vw"):(t.sizes="15vmax",t.previousElementSibling.sizes="15vmax")};$.addEventListener("click",B);Object.entries(k).forEach(([t,e])=>e.addEventListener("change",({target:{value:i}})=>G(t,i)));x.addEventListener("click",()=>{document.querySelector("div.more-filters").classList.toggle("show"),x.classList.toggle("on")});U.addEventListener("click",()=>{document.querySelector("div.controls").classList.toggle("searching"),L.focus()});L.addEventListener("change",({target:{value:t}})=>J(t));s.addEventListener("click",({target:t})=>{t===s&&t.classList.contains("empty")&&(s.classList.remove("empty"),B())});document.querySelectorAll("dl").forEach(t=>{t.addEventListener("click",e=>t.classList.toggle("show-more"))});D(s.querySelectorAll("[data-src]"),s);m=new y(s,K);s.classList.remove("loading");
